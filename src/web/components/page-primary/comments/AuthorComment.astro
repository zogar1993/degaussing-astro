---
import { Image } from "astro:assets"
import RichText from "@web/components/general/RichText.astro"
import Icon from "@web/components/general/Icon.astro"
import getAuthorsInfo from "@server/actions/GetAuthorsInfo"
import getSocialLinks from "@server/actions/GetSocialLinks"
import getLocalizedDate from "@server/localization/GetLocalizedDate"
import { getLangFromUrl, useTranslations } from "@server/i18n/utils"
import type { PageInfo } from "@server/GetPageInfo"

export interface Props {
	info: PageInfo
}

const { info } = Astro.props
const language = getLangFromUrl(Astro.url)
const t = useTranslations(language)

const links = await getSocialLinks()
const authors = await getAuthorsInfo({ language })
const lucy = authors.find(author => author.slug === "lucy")
const date = getLocalizedDate({ date: info.createdAt, language })
---
{info.author_comment &&
<section>
	<div class="heading-container">
		<h2 class="heading">{t("landmarks.author")}</h2>
		<nav>
			<ul>
				{
					links.map((link) => (
						<li>
							<a
								href={link.href}
								title={link.text}
								aria-label={link.text}
								target="_blank"
								rel="noopener"
							>
								<Icon src={link.icon} alt={link.text} />
							</a>
						</li>
					))
				}
			</ul>
		</nav>
	</div>
	<div class="comment-header">
		<Image src={lucy.portrait} alt="" width={48} height={48} />
		<span>{lucy.name}</span>
		<time class="comment-header__date" datetime={date.datetime}>{date.localized}</time>
	</div>
	<RichText text={info.author_comment} />
</section>
	}
<style>
    section {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        --author-comment_font-size: 1rem;
        --rich-text_font-size: var(--author-comment_font-size);
    }

    .comment-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: bold;
        font-size: var(--author-comment_font-size);
    }

    .comment-header__date {
        color: var(--color-muted);
    }

    .heading {
        font-family: var(--font-family-title);
        font-style: normal;
        font-weight: 400;
        font-size: 2rem;
        color: var(--heading_color);
    }

    .heading-container {
        display: flex;
        justify-content: space-between;
    }

    nav {
        display: flex;
        align-items: center;
    }

    ul {
        display: flex;
        align-items: center;
        gap: var(--buttons_gap);
    }

    a {
        display: flex;
        justify-content: center;
        align-items: center;

        width: 2rem;
        height: 2rem;
        background-color: var(--button_background-color);
        border: 1px solid var(--color-button-border);
        border-radius: var(--border-radius);

        transition: var(--link--hover_transition-timing);
        transition-property: background-color;
    }

    a:hover {
        background-color: var(--button--hover_background-color);
    }

    @media (max-width: 72em) {
        .heading {
            font-size: 1.5rem;
        }
    }
</style>